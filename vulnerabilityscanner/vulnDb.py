import vulners
import getVersion
import runCommand

vulners_api = vulners.Vulners(api_key="VKMCJC9T1FUFQDFEUPSP9YX5GB1D2TI37OB1014XQESSJ1I7X85AODKAG0K9O3KM")

def vulnDetails(host):
    versions = getVersion.getLinuxDetails(host)
    cmd = "rpm -qa --qf '%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\n'"
    stdout = runCommand.run(host, cmd)
    for pack in stdout:
        centos_vulnerabilities = vulners_api.audit(os=versions[0].lower(), os_version=versions[1],
                                                   package=[pack.strip('\n')])
        vulnerable_packages = centos_vulnerabilities.get('packages')
        missed_patches_ids = centos_vulnerabilities.get('vulnerabilities')
        cve_list = centos_vulnerabilities.get('cvelist')
        how_to_fix = centos_vulnerabilities.get('cumulativeFix')
        print(cve_list)





