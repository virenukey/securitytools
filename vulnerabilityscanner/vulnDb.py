import vulners
import getVersion
import runCommand
import configparser

config = configparser.ConfigParser()
config.read('config.ini')
api_key = config["vulns"]["api_key"]

vulners_api = vulners.Vulners(api_key=api_key)

def vulnDetails(host):
    versions = getVersion.getLinuxDetails(host)
    cmd = "rpm -qa --qf '%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\n'"
    stdout = runCommand.run(host, cmd)
    for pack in stdout:
        centos_vulnerabilities = vulners_api.audit(os=versions[0].lower(), os_version=versions[1],
                                                   package=[pack.strip('\n')])
        vulnerable_packages = centos_vulnerabilities.get('packages')
        missed_patches_ids = centos_vulnerabilities.get('vulnerabilities')
        cve_list = centos_vulnerabilities.get('cvelist')
        how_to_fix = centos_vulnerabilities.get('cumulativeFix')
        print("Following are CVE's for vulnerable package %s" % pack.strip('\n'))
        print(",".join(cve_list))





